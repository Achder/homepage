---
import PageLayout from "../layouts/PageLayout.astro"
---

<PageLayout>
	<canvas>
	</canvas>
</PageLayout>

<style>
	* {
		box-sizing: border-box;
	}

	canvas {
		box-sizing: border-box;
		padding: 2px;
		outline: 2px solid black;
		outline-offset: -1px;
		width: 100%;
		aspect-ratio: 1 / 1;
	}
</style>

<script>

	import { Game } from '../snake/game'

	function getInnerSize(element: HTMLElement | null) {
		if(!element) {
			return null
		}
		
		const computed = getComputedStyle(element)
		return {
			width: element.clientWidth - parseFloat(computed.paddingLeft) - parseFloat(computed.paddingRight),
			height: element.clientHeight - parseFloat(computed.paddingTop) - parseFloat(computed.paddingBottom)
		}
	}
	
	let game: Game
	document.addEventListener('DOMContentLoaded', event => {

		const canvas = document.querySelector("canvas")
		const container = canvas?.parentElement ?? null
		const size = getInnerSize(container)
		const segmentSize = 20
		const field = {
			width: Math.floor((size?.width ?? 0) / segmentSize),
			height: Math.floor((size?.height ?? 0) / segmentSize),
		}

		if(canvas) {
			canvas.width = field.width * segmentSize
			canvas.height = field.height * segmentSize
		}

		game = new Game(field, segmentSize)
		game.loop()
  })
</script>